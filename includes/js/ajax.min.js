$(document).ready(function(){$("body").on("submit","form.o1",function(e){e.preventDefault();var s=$(this),t=$(this).attr("name")+"-process",a=$(this).data("redirect"),o=$(this).data("reset");return $(s).find(".message").html('<img src="'+site_url+'resources/images/waiting.gif" class="mx-auto d-block" width="80">'),$(s).find('input[type="submit"]').prop("disabled",!0),$.ajax({data:s.serialize(),type:s.attr("method"),url:site_url+"ajax.php?process="+t,success:function(e){console.log("response: "+e);var t=JSON.parse(e);"success"===t.status&&("yes"==o&&($(s)[0].reset(),void 0!==t.response_id&&void 0!==a&&(a+="&id="+t.response_id)),$(s).find('input[type="submit"]').prop("disabled",!1)),$(s).find(".message").show(1e3).html('<span class="alert alert-'+t.status+' d-block">'+t.message+"</span>"),"success"===t.status&&void 0!==a&&setTimeout(function(e){window.location.href=a},6e3)},error:function(e,s,t){},complete:function(){}}),!1}),$("body").on("submit","form.api",function(e){e.preventDefault();var s=$(this),t=$(this).serialize(),a=($(this).attr("action"),$(this).attr("method")),o=$(this).data("reset"),i=$(this).data("popup"),n=$(this).data("scroll"),r=($(this).data("validate"),$(this).data("function"),$(this).data("aftersuccess")),c=$(this).attr("name")+"-process";$(this).data("targetele"),$("#booking_id").val();return $(s).next(".message").slideDown().html('<img src="'+site_url+'resources/images/waiting.gif" class="mx-auto d-block" width="80">'),$(s).find("input#submitBtn").prop("disabled",!0),$.ajax({data:s.serialize(),type:a,url:site_url+"ajax.php?process="+c,success:function(e){console.log(e),window.innerWidth>800&&$("label[data-toggle='popover']").popover({trigger:"hover"});var a=JSON.parse(e);"yes"!==i?($(s).closest("div").find(".message").slideDown().html('<span class="text-'+a.status+'">'+a.message+"</span>"),"yes"===n&&$("html, body").animate({scrollTop:$(s).closest("div").find(".message").offset().top-68},800)):($(s).closest("div").find(".message").html(""),$("#bookingSuccessModal .modal-body").html(a.message),$("#bookingSuccessModal").modal("toggle")),void 0!==r&&""!==r&&"success"==a.status&&(console.log(a.refID),console.log("mail init"),$.ajax({data:t+"&refID="+a.refID+"&fare="+a.fare,type:"POST",url:site_url+"ajax.php?process="+r+"-process",success:function(e){emailres=JSON.parse(e),"danger"==emailres.status?($("#bookingSuccessModal .modal-body").html('<span class="text-'+emailres.status+'">'+emailres.message+"</span>"),($("#bookingSuccessModal").data("bs.modal")||{})._isShown||$("#bookingSuccessModal").modal("toggle")):"success"==emailres.status&&console.log("mail sent")},error:function(e,s,t){},complete:function(){}})),"yes"==o&&($(s)[0].reset(),$("form")[0].reset(),$("#fares").slideUp()),datetimeinit(),telephone(),imgtosvg(),$(s).find("input#submitBtn").prop("disabled",!1)},error:function(e,s,t){},complete:function(){}}),!1}),$("body").on("submit","form.cancelBooking",function(e){e.preventDefault();var s=$(this).attr("method"),t=$(this).attr("name")+"-process",a=$(this);return $(a).find(".message").html(""),!!confirm("Are you sure want to cancel the booking?")&&($.ajax({data:a.serialize(),type:s,url:site_url+"ajax.php?process="+t,success:function(e){1==JSON.parse(e).success?(console.log("Booking Cancelled"),$("#status").addClass("text-danger").html("Cancelled"),$("button#cancel-booking").remove(),$("#cancel-conf-modal").modal("hide")):$(a).find(".message").html("Cancellation failed! Please make sure the phone number entered was used when making the booking.")},error:function(e,s,t){},complete:function(){}}),!1)}),$("form.uploads").on("submit",function(e){function s(e){if(e.lengthComputable){var s=parseInt(e.loaded/e.total*100);$("#progress #progbarWidth").text(s+"%"),$("#progbarWidth").width(s+"%")}}e.preventDefault();var t=$(this);$(this).attr("name");$("#progbarWidth").width(0);var a=$(this).attr("name")+"-process";$(".message span").hide();var o=new FormData(this),i=$(this).data("reset");return $.ajax({data:o,type:"POST",url:site_url+"ajax.php?process="+a,xhr:function(){return myXhr=$.ajaxSettings.xhr(),myXhr.upload&&myXhr.upload.addEventListener("progress",s,!1),myXhr},success:function(e){"yes"==i&&$(t)[0].reset(),$(t).next(".message").next("#progress").hide("fast"),$(t).find(".message").slideDown(500,function(){$(t).find(".message").html(e)}),$(".message span").delay(1e4).slideUp(2e3,function(){$(".message span").remove()})},error:function(e,s,t){},complete:function(){},cache:!1,contentType:!1,processData:!1}),$(t).next(".message").after("<div id='progress'><div id='progbarWidth'></div></div>"),!1}),$("body").on("click","button#cancel-submit",function(e){var s=$("#quick-book-panel form.api"),t=function(){var e=document.cookie.match(/PHPSESSID=[^;]+/);return null!=e&&(e=e instanceof Array?e[0].substring(11):e.substring(11)),e}();$.ajax({data:s.serialize()+"&session="+t,type:"POST",url:site_url+"ajax.php?process=statistics-process",success:function(e){console.log("response: "+e);JSON.parse(e).status},error:function(e,s,t){},complete:function(){}})})});